<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exploring the Data Source Subsystem :: Red Hat JBoss EAP Administration I</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="logging.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img
          src="../../../_/img/redhat-logo.png"
          height="40px"
          alt="Red Hat"
        /></a>
      <a
        class="navbar-item"
        style="font-size: 24px; color: white"
        href="../../.."
      >Red Hat JBoss EAP Administration I</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a
          class="navbar-item"
          href="https://github.com/RedHatQuickCourses/eap-admin1/issues"
          target="_blank"
        >Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="eap-admin1" data-version="8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat JBoss EAP Administration I</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install/index.html">Introduction to Red Hat JBoss EAP 8</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/install.html">Red Hat JBoss Enterprise Application Platform 8 Installation Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/admin.html">Managing Red Hat JBoss EAP 8</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/extensions.html">Interpreting Extensions, Subsystems, and Profiles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../config/index.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../config/eap-config.html">Red Hat JBoss EAP 8 Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../config/eap-cli.html">Red Hat JBoss EAP 8 CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../config/deploy.html">Deploying Applications to a Standalone Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Subsystems</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="database.html">Exploring the Data Source Subsystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="logging.html">Configuring Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="messaging.html">Configuring Messaging (JMS)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="web.html">Configuring the Web Subsystem</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat JBoss EAP Administration I</span>
    <span class="version">8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat JBoss EAP Administration I</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat JBoss EAP Administration I</a></li>
    <li><a href="index.html">Subsystems</a></li>
    <li><a href="database.html">Exploring the Data Source Subsystem</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Exploring the Data Source Subsystem</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you interpret the database subsystem and connection pools.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_sources"><a class="anchor" href="#_data_sources"></a>Data Sources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Jakarta EE applications commonly interact with databases for basic create, read, update, and delete (CRUD) operations.</p>
</li>
<li>
<p>Data sources securely provide access to databases without exposing sensitive information.</p>
</li>
<li>
<p>Declaring a new data source consists of two separate steps:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installing the JDBC driver for a particular database server vendor.</p>
</li>
<li>
<p>Define a data source within the datasource subsystem of the configuration file.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_datasource_types"><a class="anchor" href="#_datasource_types"></a>Datasource Types</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>When creating a datasource in the Red Hat JBoss EAP 8 management interface, you choose between two types:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Non-XA datasources: For applications with single-database transactions.</p>
</li>
<li>
<p>XA datasources: For applications with multiple databases or XA resources in one transaction.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_connection_pools"><a class="anchor" href="#_database_connection_pools"></a>Database Connection Pools</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Managing data sources involves handling traffic and concurrent connections to the database, which can become a bottleneck during peak loads.</p>
</li>
<li>
<p>Red Hat JBoss EAP 8 optimizes data access by creating a database connection pool, providing instant connections to the application.</p>
</li>
<li>
<p>This eliminates the need to open and close connections for every request.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each application&#8217;s database instance necessitates its own connection pool.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_datasources"><a class="anchor" href="#_configuring_datasources"></a>Configuring Datasources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_understanding_data_source_configuration"><a class="anchor" href="#_understanding_data_source_configuration"></a>Understanding Data Source configuration</h3>
<div class="ulist">
<ul>
<li>
<p>In Red Hat JBoss EAP 8, you can find datasoure configurations within the datasource subsystem, in the <strong>domain.xml</strong> or <strong>standalone.xml</strong> files.</p>
</li>
<li>
<p>The data source subsystem has the following structure:</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im1.png" alt="im1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The JNDI name used to look up the data source.</p>
</li>
<li>
<p>The name of the management pool for the datasource.</p>
</li>
<li>
<p>Dictates whether the data source is enabled or disabled.</p>
</li>
<li>
<p>Dictates whether to bind the data source to global JNDI.</p>
</li>
<li>
<p>The JDBC driver connection URL.</p>
</li>
<li>
<p>The connection pool settings.</p>
</li>
<li>
<p>Security credentials for connecting to the database.</p>
</li>
<li>
<p>The validation strategies for the data source connections.</p>
</li>
<li>
<p>Contains child elements which are timeout settings.</p>
</li>
<li>
<p>Describes the configuration for the behavior of prepared statements.</p>
</li>
<li>
<p>The available drivers definitions.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>More on data source configuration sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;datasources&gt; and &lt;datasource&gt; section</strong>:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Multiple &lt;datasource&gt; entries can be defined within the &lt;datasources&gt; subsystem, each requiring a unique JNDI name specified by the jndi-name attribute.</p>
</li>
<li>
<p>Valid JNDI names start with "java:" or "java:/jboss", like "java:/jboss/datasources/bookstore".</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>&lt;pool&gt; section</strong>:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pool configurations in the &lt;pool&gt; section include &lt;min-pool-size&gt;, &lt;max-pool-size&gt;, and &lt;prefill&gt;, where &lt;prefill&gt; populates the connection pool initially.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>&lt;validation&gt; section</strong>:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The &lt;validation&gt; section offers settings for validating database connections.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>&lt;statement&gt; section</strong>:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the &lt;statement&gt; section, &lt;prepared-statement-cache-size&gt; dictates the number of cached prepared statements per connection, while &lt;share-prepared-statements&gt; determines if non-closed prepared statements can be reused.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>&lt;drivers&gt; section</strong>:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The &lt;drivers&gt; section is for defining JDBC drivers that are deployed as modules.</p>
</li>
<li>
<p>The name attribute for the driver corresponds to the value used in the <strong>&lt;datasource&gt;</strong> definition.</p>
</li>
<li>
<p>The module attribute must be assigned to a deployed module on the server.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_jdbc_drivers"><a class="anchor" href="#_configuring_jdbc_drivers"></a>Configuring JDBC Drivers</h3>
<div class="ulist">
<ul>
<li>
<p>Java Database Connectivity (JDBC) is a Java API to communicate with relational databases.</p>
</li>
<li>
<p>Java applications use the JDBC driver to perform database operations.</p>
</li>
<li>
<p>JDBC drivers are available from database vendors, such as from MariaDB or PostgreSQL.</p>
</li>
<li>
<p>To use a JDBC driver in Red Hat JBoss EAP 8, you first need install the driver as a module on the server.</p>
</li>
<li>
<p>Ways to add the JDBC driver module:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manually</p>
</li>
<li>
<p>Using management CLI</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_jdbc_driver_using_management_cli"><a class="anchor" href="#_jdbc_driver_using_management_cli"></a>JDBC driver using management CLI</h4>
<div class="ulist">
<ul>
<li>
<p>This method requires the user to provide:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Name</strong>: A name based on a Java package name that JBoss EAP uses to store the JAR file and a module configuration file. The name must be unique and cannot conflict with the existing libraries available at the $JBOSS_HOME/modules directory.</p>
</li>
<li>
<p><strong>Resources</strong>: Refers to the location that stores the JAR file.</p>
</li>
<li>
<p><strong>Dependencies</strong>: Identify which JBoss EAP modules are used by the JDBC driver.</p>
</li>
<li>
<p>The syntax for the module add command is:</p>
<div class="listingblock">
<div class="content">
<pre>[disconnected /] module add \
--name=&lt;module_name&gt; \
--resources=&lt;JDBC_Driver&gt; \
--dependencies=&lt;library1&gt;,&lt;library2&gt;,...</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>For example, the following command in the management CLI creates the JDBC PostreSQL module by using the file postgresql-42.x.y.jar that the database vendor provides:</p>
<div class="listingblock">
<div class="content">
<pre>[disconnected /] module add \
--name=com.postgresql \
--resources=/path/to/postgresql-42.x.y.jar \
--dependencies=javaee.api,sun.jdk,ibm.jdk,javax.api,javax.transaction.api</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can run this command in the management CLI disconnected mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>This command creates the <strong>$JBOSS_HOME/modules/com/postgresql/main</strong> directory with the JDBC JAR file and a module.xml with the dependencies you specify in the command.</p>
</li>
<li>
<p>If you need to remove a module from JBoss EAP, then you can stop the server, and run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>[disconnected /] module remove --name=&lt;module_name&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_defining_drivers"><a class="anchor" href="#_defining_drivers"></a>Defining Drivers</h4>
<div class="ulist">
<ul>
<li>
<p>After adding the driver as a module, the next step is to create a &lt;driver&gt; definition in the &lt;drivers&gt; section of the data source subsystem in the JBoss EAP configuration file.</p>
</li>
<li>
<p>Use the following management CLI operation to add the &lt;driver&gt; definition on a standalone server:</p>
<div class="listingblock">
<div class="content">
<pre>/subsystem=datasources/jdbc-driver=&lt;driver_name&gt;:add\
(driver-module-name=&lt;module_name&gt;,driver-name=&lt;unique_driver_name&gt;)</pre>
</div>
</div>
</li>
<li>
<p>In the driver definition command, the following fields are required:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>driver-name</strong>: A unique name for the driver.</p>
</li>
<li>
<p><strong>driver-module-name</strong>: The unique name from the module installed at the <strong>$JBOSS_HOME/modules</strong> directory.</p>
</li>
</ol>
</div>
</li>
<li>
<p>When you define the driver with the management CLI, the domain.xml or the standalone.xml configuration file shows additional tags that are similar to the following driver tag:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;drivers&gt;
    &lt;driver name="postgresql" module="com.postgresql"/&gt;
&lt;/drivers&gt;</pre>
</div>
</div>
</li>
<li>
<p>After defining the &lt;driver&gt; in the &lt;drivers&gt; section of the data source subsystem, the driver is referenced by its name attribute and users can create data sources that use the driver.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_data_sources_with_the_management_console"><a class="anchor" href="#_creating_data_sources_with_the_management_console"></a>Creating Data Sources with the Management Console</h3>
<div class="ulist">
<ul>
<li>
<p>The EAP management console simplifies datasource creation by offering preconfigured templates for various database vendors.</p>
</li>
<li>
<p>Follow these steps to create a non-XA datasource in a standalone server using the management console.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Configuration</strong> from the top of the management console and naviagate to <strong>Subsystems&gt;Datasources &amp; Drivers&gt;Datasources</strong> to access the non-XA data source page.</p>
</li>
<li>
<p>Then click Add Datasource in the <strong>+</strong> drop-down menu.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im3.png" alt="im3">
</div>
</div>
</li>
<li>
<p>Select a database template and click <strong>Next</strong>. If none of them are valid, then select the Custom option and see the JDBC driver documentation to complete the following steps.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im4.png" alt="im4">
</div>
</div>
</li>
<li>
<p>Enter the datasource attributes and click <strong>Next</strong>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im5.png" alt="im5">
</div>
</div>
</li>
<li>
<p>Select a database driver in the Driver Name drop-down menu and click <strong>Next</strong>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/newone.png" alt="newone">
</div>
</div>
</li>
<li>
<p>Enter the connection URL, username, and password for the database and click Next.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im7.png" alt="im7">
</div>
</div>
</li>
<li>
<p>Click <strong>Test Connection</strong> to verify that the datasource can connect to the database. Note that if you test the connection at this step, then the management console creates the datasource. You can click <strong>Next</strong> and test the connection later.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the final step, notice that the connection URL is formatted for the correct MySQL syntax. Click <strong>Done</strong> to finish creating the data source.</p>
</li>
<li>
<p>Finally, a window with a configuration summary shows and you can click <strong>Finish</strong>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im8.png" alt="im8">
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_testing_the_data_source"><a class="anchor" href="#_testing_the_data_source"></a>Testing the Data Source</h4>
<div class="ulist">
<ul>
<li>
<p>The management console provides a <strong>Test Connection</strong> button to verify that the connections from a connection pool can access the database.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/newtwo.png" alt="newtwo">
</div>
</div>
</li>
<li>
<p>Likewise, the management CLI can be used to test if the data source was correctly configured. To validate it, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost /] /subsystem=datasources/\
data-source=datasource_name:test-connection-in-pool</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_dataources_with_the_eap_management_cli"><a class="anchor" href="#_creating_dataources_with_the_eap_management_cli"></a>Creating Dataources with the EAP Management CLI</h3>
<div class="ulist">
<ul>
<li>
<p>You can create data sources by using the management CLI.</p>
</li>
<li>
<p>For example, the following command creates a MySQL datasource, called MySqlDS, with connection validation configured:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost] data-source add --name=MySqlDS --jndi-name=java:jboss/MySqlDS \
--driver-name=mysql \
--connection-url=jdbc:mysql://localhost:3306/jbossdb \
--user-name=admin --password=admin \
--validate-on-match=true --background-validation=false \
--valid-connection-checker-class-name=\
org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker \
--exception-sorter-class-name=\
org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter</pre>
</div>
</div>
</li>
<li>
<p>The previous command generates the following datasource configuration in the datasource subsystem:</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/newthree.png" alt="newthree">
</div>
</div>
</li>
<li>
<p>Explaination</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The JNDI name that would be used to look up the data source by a component on the EAP server.</p>
</li>
<li>
<p>The name that refers to the driver that is defined in the &lt;drivers&gt; section below the data source.</p>
</li>
<li>
<p>The credentials used to access the MySQL database.</p>
</li>
<li>
<p>Both validate on match and background validation are defined, but only one of them can be enabled.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_1_configuring_jdbc_drivers"><a class="anchor" href="#_lab_1_configuring_jdbc_drivers"></a>Lab 1: Configuring JDBC Drivers</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Outcome</strong>: In this lab, you install the MariaDB JDBC driver as a module, and enable it in the server configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the <strong>mariadb-java-client-3.3.2.jar</strong> files.</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ sudo wget -c /opt <a href="https://repo1.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/3.3.2/mariadb-java-client-3.3.2.jar" class="bare">https://repo1.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/3.3.2/mariadb-java-client-3.3.2.jar</a></pre>
</div>
</div>
</li>
<li>
<p>Start the standalone instance of JBoss EAP 8 by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ cd /opt/EAP-8.0.0/bin
[vagrant@server bin]$ sudo -u jboss ./standalone.sh</pre>
</div>
</div>
</li>
<li>
<p>Create the module.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installing the driver as a module makes it available to any JBoss EAP 8 instance.</p>
</li>
<li>
<p>Use the following management CLI command to create the module by pointing to the JDBC JAR file, listing the JAR&#8217;s dependencies and using the MariaDB driver vendor ID as the name:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] module add --name=com.mariadb --resources=/opt/mariadb-java-client-3.3.2.jar --dependencies=javaee.api,sun.jdk,ibm.jdk,javax.api,javax.transaction.api</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Open a new terminal, and validate that the driver installs as a module by listing the JBOSS_HOME/modules/com/mariadb/main directory.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the directory contains the module.xml and <code>mariadb-java-client-3.3.2.jar</code> files:</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ ls -l /opt/EAP-8.0.0/modules/com/mariadb/main/
total 652
-rw-r--r--. 1 jboss jboss 662472 Apr 23 08:00 mariadb-java-client-3.3.2.jar
-rw-r--r--. 1 jboss jboss    410 Apr 23 08:00 module.xml</pre>
</div>
</div>
</li>
<li>
<p>Also, verify that the module.xml file generates correctly by comparing it with the following listing:</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ cat /opt/EAP-8.0.0/modules/com/mariadb/main/module.xml
&lt;?xml version="1.0" ?&gt;

&lt;module xmlns="urn:jboss:module:1.1" name="com.mariadb"&gt;

    &lt;resources&gt;
        &lt;resource-root path="mariadb-java-client-3.3.2.jar"/&gt;
    &lt;/resources&gt;

    &lt;dependencies&gt;
        &lt;module name="javaee.api"/&gt;
        &lt;module name="sun.jdk"/&gt;
        &lt;module name="ibm.jdk"/&gt;
        &lt;module name="javax.api"/&gt;
        &lt;module name="javax.transaction.api"/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Open a new terminal and start the management CLI as the jboss user.</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ cd /opt/EAP-8.0.0/bin
[vagrant@server bin]$ sudo -u jboss ./jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /]</pre>
</div>
</div>
</li>
<li>
<p>Use the following command to define the MariaDB driver by specifying the JBoss EAP 8module:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=datasources\
&gt; /jdbc-driver=mariadb:add(driver-name=mariadb,driver-module-name=com.mariadb)
{"outcome" =&gt; "success"}</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the driver-module-name has the`com.mariadb` value from the module.xml file.</p>
</div>
</li>
<li>
<p>Verify the driver configuration. Use the following command to inspect the new MariaDB JDBC driver:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=datasources\
&gt; /jdbc-driver=mariadb:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "deployment-name" =&gt; undefined,
        "driver-class-name" =&gt; undefined,
        "driver-datasource-class-name" =&gt; undefined,
        "driver-major-version" =&gt; undefined,
        "driver-minor-version" =&gt; undefined,
        "driver-module-name" =&gt; "com.mariadb",
        "driver-name" =&gt; "mariadb",
        "driver-xa-datasource-class-name" =&gt; undefined,
        "jdbc-compliant" =&gt; undefined,
        "module-slot" =&gt; undefined,
        "profile" =&gt; undefined
    }
}</pre>
</div>
</div>
</li>
<li>
<p>Exit the management CLI:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] exit</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2_creating_data_sources_with_the_management_console"><a class="anchor" href="#_lab_2_creating_data_sources_with_the_management_console"></a>Lab 2: Creating Data Sources with the Management Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Outcome</strong>: In this lab, you create and test a data source based on the MariaDB driver.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install and configure mariadb server.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install mariadb package and start it&#8217;s service.</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ sudo dnf install mariadb-server
[vagrant@server ~]$ sudo systemctl start mariadb.service</pre>
</div>
</div>
</li>
<li>
<p>Configure mariadb server as per your requirements by executing below command.</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ sudo mysql_secure_installation</pre>
</div>
</div>
</li>
<li>
<p>Log in to the mariadb server and create database named <strong>lab-db</strong>, user named <strong>developer</strong> with password <strong>redhat123</strong> and grant ALL privileges for <strong>lab-db</strong> database to <strong>developer</strong> user.</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ sudo mysql -uroot

MariaDB [(none)]&gt; create database lab_db;
Query OK, 1 row affected (0.000 sec)

MariaDB [(none)]&gt; CREATE USER 'developer'@'%' IDENTIFIED BY 'redhat123';
Query OK, 0 rows affected (0.002 sec)

MariaDB [(none)]&gt; GRANT ALL privileges ON lab_db.* TO 'developer'@'%';
Query OK, 0 rows affected (0.006 sec)

MariaDB [(none)]&gt; exit;
Bye</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure and test the data source.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigating to <a href="http://localhost:9990" class="bare">http://localhost:9990</a>. Use <code>admin</code> as the username, and <code>redhat123</code> as the password.</p>
</li>
<li>
<p>Navigate to the datasources subsystem by clicking <strong>Configuration</strong> &#8594; <strong>Subsystems</strong> &#8594; <strong>Datasources &amp; Drivers</strong>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im2.png" alt="im2">
</div>
</div>
</li>
<li>
<p>Click <strong>Datasources</strong>, and then open the Datasource menu by clicking the <strong>+</strong> sign. Select the <strong>Add Datasource</strong> option.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im3.png" alt="im3">
</div>
</div>
</li>
<li>
<p>On the first window, select MariaDB and click Next.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/im4.png" alt="im4">
</div>
</div>
</li>
<li>
<p>Enter the following data and click Next:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Name</strong>: test-ds</p>
</li>
<li>
<p><strong>JNDI Name</strong>: java:jboss/datasources/test-ds</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click Next to accept the following values in the JDBC Driver step.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Driver Name</strong>: mariadb</p>
</li>
<li>
<p><strong>Driver Class Name</strong>: org.mariadb.jdbc.Driver</p>
</li>
</ol>
</div>
</li>
<li>
<p>Complete the Connection step with the following data and click <strong>Next</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Connection URL</strong>: jdbc:mariadb://localhost:3306/lab_db</p>
</li>
<li>
<p><strong>User Name</strong>: developer</p>
</li>
<li>
<p><strong>Password</strong>: redhat123</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Test Connection</strong> to verify that the datasource has access to the database.</p>
</li>
<li>
<p>Click Next to go to the Review step and then click Finish and Close to complete the process.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify the data source configuration.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the terminal window where the server is running, look for the following log event:</p>
<div class="listingblock">
<div class="content">
<pre>03:19:56,646 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-2) WFLYJCA0001: Bound data source [java:jboss/datasources/test-ds]</pre>
</div>
</div>
</li>
<li>
<p>Start the management CLI in a new terminal window:</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ cd /opt/EAP-8.0.0/bin
[vagrant@server bin]$ sudo -u jboss ./jboss-cli.sh</pre>
</div>
</div>
</li>
<li>
<p>Use the following command to see the newly added data source as well as the other fields that can be modified:</p>
<div class="listingblock">
<div class="content">
<pre>[disconnected /] connect
[standalone@localhost:9990] /subsystem=datasources/data-source=\
test-ds:read-resource
...output omitted...
        "datasource-class" =&gt; undefined,
        "driver-class" =&gt; "org.mariadb.jdbc.Driver",
        "driver-name" =&gt; "mariadb",
        "elytron-enabled" =&gt; false,
        "enabled" =&gt; true,
        "enlistment-trace" =&gt; false,
        "exception-sorter-class-name" =&gt; "org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter",
        "exception-sorter-properties" =&gt; undefined,
        "flush-strategy" =&gt; undefined,
        "idle-timeout-minutes" =&gt; undefined,
        "initial-pool-size" =&gt; undefined,
        "jndi-name" =&gt; "java:jboss/datasources/test-ds",
        "jta" =&gt; true,
        "max-pool-size" =&gt; undefined,
        "mcp" =&gt; "org.jboss.jca.core.connectionmanager.pool.mcp.SemaphoreConcurrentLinkedDequeManagedConnectionPool",
        "min-pool-size" =&gt; undefined,
        "new-connection-sql" =&gt; undefined,
...output omitted...</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Modify the data source.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure some connection pool settings by using the management CLI and the management console to improve the database performance.</p>
</li>
<li>
<p>Enter the following commands to view the current settings of the test-ds data source:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990] cd /subsystem=datasources/data-source=test-ds

[standalone@localhost:9990 data-source=test-ds] :read-resource(recursive=true)
...output omitted...
        "max-pool-size" =&gt; undefined,
        "mcp" =&gt; "org.jboss.jca.core...,
        "min-pool-size" =&gt; undefined
...output omitted...</pre>
</div>
</div>
</li>
<li>
<p>Notice that several of the attributes of the test-ds data source are undefined.</p>
</li>
<li>
<p>Enter the following command to set the minimum pool size of the test-ds data source to 5:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 data-source=test-ds] :write-attribute\
(name=min-pool-size,value=5)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}</pre>
</div>
</div>
</li>
<li>
<p>Verify the previous change:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 data-source=test-ds] :read-resource(recursive=true)
...output omitted...
"min-pool-size" =&gt; 5,
...output omitted...</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Return to the Configuration page of the management console.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>View</strong> next to <strong>test-ds</strong>.</p>
</li>
<li>
<p>Click the Pool tab. Verify that Min Pool Size is <strong>5</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Exit the management CLI:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 data-source=test-ds] exit</pre>
</div>
</div>
</li>
<li>
<p>Stop the instance of JBoss EAP by pressing <strong>Ctrl+C</strong> in the terminal window that is running JBoss EAP.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_3_creating_data_sources_using_eap_cli"><a class="anchor" href="#_lab_3_creating_data_sources_using_eap_cli"></a>Lab 3: Creating Data Sources using EAP CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Outcome</strong>: In this lab, you create and test data sources by using the management CLI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the management CLI in a new terminal window:</p>
<div class="listingblock">
<div class="content">
<pre>[vagrant@server ~]$ cd /opt/EAP-8.0.0/bin
[vagrant@server bin]$ sudo -u jboss ./jboss-cli.sh</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a mariadb datasource, called <strong>MySqlDS</strong>, with connection validation configured using command shown below.</p>
<div class="listingblock">
<div class="content">
<pre>[disconnected /] connect

[standalone@localhost:9990 /] data-source add --name=MySqlDS \
--jndi-name=java:jboss/datasources/test-ds2 --driver-name=mariadb \
--connection-url=jdbc:mariadb://localhost:3306/jbossdb \
--user-name=developer --password=redhat123 \
--validate-on-match=true --background-validation=false \
--valid-connection-checker-class-name=org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker \
--exception-sorter-class-name=org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter</pre>
</div>
</div>
</li>
<li>
<p>Enter the following commands to view the current settings of the <strong>MySqlDS</strong> data source:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /]
 cd /subsystem=datasources

[standalone@localhost:9990 subsystem=datasources] ls

[standalone@localhost:9990 subsystem=datasources] /subsystem=datasources/data-source=MySqlDS:read-resource(recursive=true)</pre>
</div>
</div>
</li>
<li>
<p>Test if the data source was correctly configured. To validate it, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre>[standalone@localhost:9990 /] /subsystem=datasources/data-source=MySqlDS:test-connection-in-pool
{
    "outcome" =&gt; "success",
    "result" =&gt; [true]
}</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Subsystems</a></span>
  <span class="next"><a href="logging.html">Configuring Logging</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
